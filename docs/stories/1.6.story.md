# 1.6.story.md - Documentation Infrastructure & Schema Discovery

## User Story
As a developer or stakeholder,
I want to access a dedicated documentation page with an up-to-date view of the database schema,
So that I can understand the data structure and relationships without looking at the code or raw DB.

## Story Context
**Existing System Integration:**
- Integrates with: Sidebar (navigation), Supabase (schema discovery).
- Technology: Svelte 4, Supabase JS, Tailwind.
- Follows pattern: Existing dashboard layout.

## Acceptance Criteria

**Functional Requirements:**
1. **Sidebar Refactoring**: Extract the hardcoded sidebar from `src/routes/data/+page.svelte` into a reusable component `src/lib/components/ui/Sidebar.svelte`.
2. **New Route**: Create `/docs` route that displays the shared sidebar and a placeholder for the schema visualizer.
3. **Sidebar Placement**: Ensure the "Documentation" link is placed at the bottom of the sidebar, just above the logout button.
4. **Schema Discovery API**: Implement a server-side load function or API endpoint that fetches the list of tables and their foreign key relationships from Supabase.
5. **Basic List View**: Display a simple list of detected tables on the `/docs` page as a first step (MVP).

**Integration Requirements:**
6. The main dashboard (`/data`) must continue to function perfectly with the new Sidebar component.
7. Supabase service role or specific permissions must allow reading `information_schema` or a custom RPC for schema discovery.

**Quality Requirements:**
8. No regression in existing sidebar functionality (farm selection, logout).
9. The schema extraction should be efficient (cached or server-side).

## Technical Notes
- **Sidebar Component**: Should accept props for active state and user data.
- **Schema Extraction**: Consider creating a PostgreSQL RPC (function) in Supabase to return JSON representing the schema (tables, columns, FKs).
- **Pattern**: Follow the existing "Tab" style for future documentation sections.

## Risk and Compatibility Check
- **Primary Risk**: Permission issues when querying `information_schema` via the client.
- **Mitigation**: Use a server-side load function with the `service_role` key (securely) or a specific RPC.
- **Rollback**: Revert sidebar extraction and delete `/docs` route.

## Definition of Done
- [ ] Sidebar is a standalone component.
- [ ] `/docs` page is accessible and shows the sidebar.
- [ ] Database tables are dynamically fetched and listed.
- [ ] Existing dashboard works as before.
