# Story 2.7: Documentation Tab

**Epic:** Frontend Application (Next.js)

## Status
Completed

## Story
**As a** Developer or Data Analyst,
**I want** to view the database schema and documentation within the application,
**so that** I can understand the data structure without leaving the platform.

---

## Acceptance Criteria

1. **AC1:** A new "Documentation" page or tab is accessible to authenticated users.
2. **AC2:** The page displays a list of database tables and their columns.
3. **AC3:** The data is fetched from the `GET /db/schema` API endpoint.
4. **AC4:** Information includes table names, column names, data types, and nullability.
5. **AC5:** The UI uses an organized Card-based layout with nested tables for columns.
6. **AC6:** The page handles loading and error states, and provides setup instructions if the backend function is missing.

---

## Tasks / Subtasks

- [x] **Task 1: Update Backend for Schema Details**
  - [x] Implement `GET /db/schema` in `backend/src/routes/db.ts`
  - [x] Add helper SQL instruction for `get_schema_details()` RPC

- [x] **Task 2: Create Documentation Page** (AC1, AC6)
  - [x] Create `frontend/src/app/docs/page.tsx`
  - [x] Implement data fetching from `/db/schema`

- [x] **Task 3: Implement Table Schema UI** (AC2, AC4, AC5)
  - [x] Build Card-based layout to iterate through tables
  - [x] Use `Table` component to list column details (Name, Type, Nullable)

- [x] **Task 4: Add Navigation**
  - [x] Add "Documentation" button to the Home page for logged-in users

---

## Dev Notes

### Backend
- New endpoint `/db/schema` returns a JSON structure of all public tables and their columns.
- Uses a fallback mechanism that provides the SQL required to create the necessary RPC function in Supabase if it doesn't exist.

### Frontend
- Uses `Database`, `Table`, and `FileCode` icons from `lucide-react`.
- Integrated with the global `AuthContext` to protect technical data.

---

## Testing

- **Manual Verification**: 
  - Verified the page displays setup instructions when the RPC is missing.
  - Verified the page correctly renders the schema once the backend returns data.
  - Verified access control (401/redirect when logged out).

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-02-05 | 1.0 | Initial story creation | Dev Agent |
| 2026-02-05 | 1.1 | Implementation completed and verified | Dev Agent |

---

## Dev Agent Record

### Agent Model Used
Gemini 2.0 Flash

### File List
- `backend/src/routes/db.ts` (updated)
- `frontend/src/app/docs/page.tsx`
- `frontend/src/app/page.tsx` (updated)
- `docs/stories/2.7.story.md`